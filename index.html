<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Satisfactory Resource Nodes — Static Dataset (Blueprint)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="data:," />
<!-- p5.js -->
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>
<style>
  /* ===== Blueprint UI Theme ===== */
  :root{
    --bg:#0a1020;           /* deep blueprint navy */
    --panel:#0f1b38;
    --panel-border:#19345f;
    --ink:#e8f1ff;          /* near-white ink */
    --muted:#9ab5d6;
    --accent:#69c8ff;       /* cyan blueprint lines */
  }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  body{
    background:
      radial-gradient(circle at 20% 15%, rgba(58,167,255,0.06), transparent 42%),
      radial-gradient(circle at 80% 70%, rgba(105,200,255,0.05), transparent 45%),
      linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04)),
      var(--bg);
  }

  /* Panels */
  #ui,#legend,#toast{
    position:fixed; z-index:10; background:rgba(15,27,56,.92);
    border:1px solid var(--panel-border); border-radius:14px;
    box-shadow: 0 8px 30px rgba(0,0,0,.25), inset 0 0 0 1px rgba(105,200,255,.06);
    backdrop-filter: blur(6px);
  }
  #ui{left:12px; top:12px; padding:14px 16px; max-width:560px}
  #legend{right:12px; top:12px; padding:10px 12px; max-width:320px; max-height:68vh; overflow:auto}
  #toast{left:50%; transform:translateX(-50%); bottom:14px; color:#cfe9ff; padding:8px 12px; font-size:13px; opacity:0; transition:opacity .25s}
  #toast.show{opacity:1}

  h1{font-size:16px; margin:0 0 8px; font-weight:800; letter-spacing:.3px}
  #legend h2{font-size:14px; margin:0 0 6px; font-weight:700}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:8px 0}
  .hint{color:var(--muted); font-size:12px; margin-top:6px}

  .badge,.pill{
    padding:2px 8px; border-radius:999px; border:1px solid #1e3e73;
    background:#0b1733; color:#a6d9ff; font-size:11px
  }
  .pill{background:#0c2246; color:#89d4ff; border-color:#1b4b85}

  #filters{display:grid; grid-template-columns:repeat(2,minmax(180px,1fr)); gap:6px 14px; margin-top:6px}
  #filters label{display:flex; gap:8px; align-items:center; cursor:pointer; font-size:12px}
  #purityFilters{display:flex; gap:16px; margin-top:6px}

  .item{display:flex; align-items:center; gap:8px; font-size:12px; margin:2px 0}
  .dot{width:12px; height:12px; border-radius:50%; border:1px solid rgba(255,255,255,.15)}

  button{
    cursor:pointer; border-radius:10px; padding:6px 10px; border:1px solid #1e3e73;
    background:linear-gradient(180deg,#0e2246,#0a1a36);
    color:#cfe9ff; font-weight:600; letter-spacing:.2px
  }
  button:hover{border-color:#2a66b0; box-shadow:0 0 0 2px rgba(105,200,255,.15) inset}
  input[type="file"]{accent-color:var(--accent);}
  a{color:var(--accent); text-decoration:none}

  #tooltip{
    position:fixed; z-index:20; background:#0b1733; border:1px solid #1f3a6b; border-radius:10px;
    padding:8px 10px; pointer-events:none; font-size:12px; display:none; max-width:360px;
    box-shadow: 0 8px 28px rgba(0,0,0,.35), inset 0 0 0 1px rgba(105,200,255,.06);
  }
</style>
</head>
<body>
  <div id="ui">
    <h1>Resource Nodes — Static Dataset</h1>
    <div class="row">
      <input id="file" type="file" accept=".json,.csv" />
      <span class="badge" id="count">0 nodes</span>
      <span class="pill">Wheel=zoom • Drag=pan</span>
    </div>
    <div class="row">
      <button id="fit">Fit to view</button>
      <label><input type="checkbox" id="labels"> show labels</label>
      <button id="exportCsv">Export CSV</button>
      <button id="exportGeo">Export GeoJSON</button>
      <button id="exportClean">Export cleaned nodes.json</button>
    </div>
    <div class="row">
      <strong>Type filters</strong>
      <div id="filters"></div>
    </div>
    <div class="row">
      <strong>Purity</strong>
      <div id="purityFilters">
        <label><input type="checkbox" data-purity="Impure" checked> Impure</label>
        <label><input type="checkbox" data-purity="Normal" checked> Normal</label>
        <label><input type="checkbox" data-purity="Pure" checked> Pure</label>
      </div>
    </div>
    <div class="hint">
      Load either:<br>
      • <code>nodes.json</code> (array of <code>{ type, purity, x, y, z }</code>)<br>
      • <code>nodes.csv</code> (header: <code>type,purity,x,y,z</code>)<br>
      • <code>en-Stable.json</code> from SC-InteractiveMap (we auto-extract).
    </div>
  </div>

  <div id="legend">
    <h2>Legend</h2>
    <div class="item"><span class="dot" style="background:#204a79"></span><span style="color:#8cbff0">Blueprint dotted grid (majors fixed; minors scale by zoom)</span></div>
    <div class="item"><span class="dot" style="background:#ff9f9f"></span><span style="color:#8cbff0">Triangles = Geysers • Diamonds = Fluids • Circles = Solids</span></div>
    <div id="legendContent"></div>
  </div>

  <div id="tooltip"></div>
  <div id="toast"></div>

  <!-- App logic -->
  <script type="module" src="app.js"></script>
</body>
</html>
